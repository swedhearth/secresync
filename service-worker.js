const appCaches = [
    {
        name: 'frequent_0.085_GitHub',
        urls: [
            "./",
            "./secresync.webmanifest",
            "./index.html",
            "./assets/src/native/app.js",
            "./assets/src/native/appDbStore.js",
            "./assets/src/native/core.js",
            "./assets/src/native/crypto.js",
            "./assets/src/native/index.js",
            "./assets/src/native/txtBank.js",
            "./assets/src/native/ui.js",
            "./assets/src/native/index.css",
            "./assets/static/appSvg/sprite.svg"
        ]
    },
    {
        name: 'rare_0.001_GitHub',
        urls: [
            "./favicon.ico",
            "./browserconfig.xml",
            
            "./assets/src/aquired/dbx.min.js",
            "./assets/src/aquired/detectIncognito.min.js",
            
            "./assets/static/@fonts/century-gothic/cg.woff2",
            "./assets/static/@fonts/century-gothic/cg.woff",
            "./assets/static/@fonts/CenturyGothic/CenturyGothic.ttf",

            "./assets/static/favicons/android-chrome-192x192.png",
            "./assets/static/favicons/apple-touch-icon.png",
            "./assets/static/favicons/apple-touch-icon-60x60.png",
            "./assets/static/favicons/apple-touch-icon-60x60-precomposed.png",
            "./assets/static/favicons/apple-touch-icon-76x76.png",
            "./assets/static/favicons/apple-touch-icon-76x76-precomposed.png",
            "./assets/static/favicons/apple-touch-icon-120x120.png",
            "./assets/static/favicons/apple-touch-icon-120x120-precomposed.png",
            "./assets/static/favicons/apple-touch-icon-152x152.png",
            "./assets/static/favicons/apple-touch-icon-152x152-precomposed.png",
            "./assets/static/favicons/apple-touch-icon-180x180.png",
            "./assets/static/favicons/apple-touch-icon-180x180-precomposed.png",
            "./assets/static/favicons/apple-touch-icon-precomposed.png",
            "./assets/static/favicons/favicon-16x16.png",
            "./assets/static/favicons/favicon-32x32.png",
            "./assets/static/favicons/mstile-70x70.png",
            "./assets/static/favicons/mstile-150x150.png",
            "./assets/static/favicons/mstile-310x150.png",
            "./assets/static/favicons/mstile-310x310.png",
            "./assets/static/favicons/safari-pinned-tab.svg",

            "./assets/static/icons/android/android-launchericon-512-512.png",
            "./assets/static/icons/android/android-chrome-512x512.png",
            "./assets/static/icons/android/android-launchericon-192-192.png",
            "./assets/static/icons/android/android-launchericon-144-144.png",
            "./assets/static/icons/android/android-launchericon-96-96.png",
            "./assets/static/icons/android/android-launchericon-72-72.png",
            "./assets/static/icons/android/android-launchericon-48-48.png",
            "./assets/static/icons/ios/16.png",
            "./assets/static/icons/ios/20.png",
            "./assets/static/icons/ios/29.png",
            "./assets/static/icons/ios/32.png",
            "./assets/static/icons/ios/40.png",
            "./assets/static/icons/ios/50.png",
            "./assets/static/icons/ios/57.png",
            "./assets/static/icons/ios/58.png",
            "./assets/static/icons/ios/60.png",
            "./assets/static/icons/ios/64.png",
            "./assets/static/icons/ios/72.png",
            "./assets/static/icons/ios/76.png",
            "./assets/static/icons/ios/80.png",
            "./assets/static/icons/ios/87.png",
            "./assets/static/icons/ios/100.png",
            "./assets/static/icons/ios/114.png",
            "./assets/static/icons/ios/120.png",
            "./assets/static/icons/ios/128.png",
            "./assets/static/icons/ios/144.png",
            "./assets/static/icons/ios/152.png",
            "./assets/static/icons/ios/167.png",
            "./assets/static/icons/ios/180.png",
            "./assets/static/icons/ios/192.png",
            "./assets/static/icons/ios/256.png",
            "./assets/static/icons/ios/512.png",
            "./assets/static/icons/ios/1024.png",
            "./assets/static/icons/windows11/SmallTile.scale-100.png",
            "./assets/static/icons/windows11/SmallTile.scale-125.png",
            "./assets/static/icons/windows11/SmallTile.scale-150.png",
            "./assets/static/icons/windows11/SmallTile.scale-200.png",
            "./assets/static/icons/windows11/SmallTile.scale-400.png",
            "./assets/static/icons/windows11/Square150x150Logo.scale-100.png",
            "./assets/static/icons/windows11/Square150x150Logo.scale-125.png",
            "./assets/static/icons/windows11/Square150x150Logo.scale-150.png",
            "./assets/static/icons/windows11/Square150x150Logo.scale-200.png",
            "./assets/static/icons/windows11/Square150x150Logo.scale-400.png",
            "./assets/static/icons/windows11/Wide310x150Logo.scale-100.png",
            "./assets/static/icons/windows11/Wide310x150Logo.scale-125.png",
            "./assets/static/icons/windows11/Wide310x150Logo.scale-150.png",
            "./assets/static/icons/windows11/Wide310x150Logo.scale-200.png",
            "./assets/static/icons/windows11/Wide310x150Logo.scale-400.png",
            "./assets/static/icons/windows11/LargeTile.scale-100.png",
            "./assets/static/icons/windows11/LargeTile.scale-125.png",
            "./assets/static/icons/windows11/LargeTile.scale-150.png",
            "./assets/static/icons/windows11/LargeTile.scale-200.png",
            "./assets/static/icons/windows11/LargeTile.scale-400.png",
            "./assets/static/icons/windows11/Square44x44Logo.scale-100.png",
            "./assets/static/icons/windows11/Square44x44Logo.scale-125.png",
            "./assets/static/icons/windows11/Square44x44Logo.scale-150.png",
            "./assets/static/icons/windows11/Square44x44Logo.scale-200.png",
            "./assets/static/icons/windows11/Square44x44Logo.scale-400.png",
            "./assets/static/icons/windows11/StoreLogo.scale-100.png",
            "./assets/static/icons/windows11/StoreLogo.scale-125.png",
            "./assets/static/icons/windows11/StoreLogo.scale-150.png",
            "./assets/static/icons/windows11/StoreLogo.scale-200.png",
            "./assets/static/icons/windows11/StoreLogo.scale-400.png",
            "./assets/static/icons/windows11/SplashScreen.scale-100.png",
            "./assets/static/icons/windows11/SplashScreen.scale-125.png",
            "./assets/static/icons/windows11/SplashScreen.scale-150.png",
            "./assets/static/icons/windows11/SplashScreen.scale-200.png",
            "./assets/static/icons/windows11/SplashScreen.scale-400.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-16.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-20.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-24.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-30.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-32.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-36.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-40.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-44.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-48.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-60.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-64.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-72.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-80.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-96.png",
            "./assets/static/icons/windows11/Square44x44Logo.targetsize-256.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-16.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-20.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-24.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-30.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-32.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-36.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-40.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-44.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-48.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-60.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-64.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-72.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-80.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-96.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-unplated_targetsize-256.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-16.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-20.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-24.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-30.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-32.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-36.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-40.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-44.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-48.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-60.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-64.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-72.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-80.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-96.png",
            "./assets/static/icons/windows11/Square44x44Logo.altform-lightunplated_targetsize-256.png"
        ]
    }
];

self.addEventListener('install', event => {
    event.waitUntil(
        caches.keys().then(keys => 
            Promise.all(
                appCaches.map(appCache => keys.includes(appCache.name) || caches.open(appCache.name).then(cache => cache.addAll(appCache.urls))) //returns true || cache.addAll promise
            )
            .then(cs => console.log('Service Worker has been installed. All relevant resources have been fetched and cached', cs))
            .catch(err => console.error('Error while caching during installing!!!', err))// !!! TO DO !!!
        )
    );
});

self.addEventListener('message', event => {
    if (event.data.action === 'skipWaiting') self.skipWaiting();
});

self.addEventListener('activate', event => {
    const cacheWhitelist = appCaches.map(appCache => appCache.name);
    event.waitUntil(
        caches.keys().then(keys => 
            Promise.all(keys.map(key => !cacheWhitelist.includes(key) && caches.delete(key))) // key is in the cacheWhitelist - cache has not been deleted - returns false || key is not in the cacheWhitelist - returns the delete cache promise, then true
            .then(cs => console.log('Service Worker has been activated. All old caches have been deleted.',keys, cs))
            .catch(err => console.error('Error while deleting caches during activation!!!', err))// !!! TO DO !!!
        )
    );
});


self.addEventListener('fetch', event => {
    if (event.request.method === 'GET')
        event.respondWith(caches.match(event.request)
        .then(response =>  response || fetch(event.request)
            .then(response)
            .catch(err => console.error("catch in fetch(event.request) in Service worker", event.request, err))
        )
        .catch(err => console.error("catch in event.respondWith(caches.match(event.request) in Service worker", event.request, err)));
});
